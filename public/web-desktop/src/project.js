window.__require=function e(t,n,s){function c(a,r){if(!n[a]){if(!t[a]){var d=a.split("/");if(d=d[d.length-1],!t[d]){var i="function"==typeof __require&&__require;if(!r&&i)return i(d,!0);if(o)return o(d,!0);throw new Error("Cannot find module '"+a+"'")}a=d}var l=n[a]={exports:{}};t[a][0].call(l.exports,function(e){return c(t[a][1][e]||e)},l,l.exports,e,t,n,s)}return n[a].exports}for(var o="function"==typeof __require&&__require,a=0;a<s.length;a++)c(s[a]);return c}({CardModel:[function(e,t,n){"use strict";function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}cc._RF.push(t,"c2a1bEq3mlHeKEVeBFpM8H0","CardModel"),Object.defineProperty(n,"__esModule",{value:!0});n.default=function e(t){s(this,e),this.name=t},t.exports=n.default,cc._RF.pop()},{}],Constants:[function(e,t,n){"use strict";cc._RF.push(t,"79f50jxO+9H1rWTW+uatN7m","Constants"),t.exports.remoteUrl="qian-qiu-xi.herokuapp.com",t.exports.events={CREATE_PLAYER_ID:"CREATE_PLAYER_ID",PAIRING:"PAIRING",START:"START",SELECT_CARD:"SELECT_CARD",CARD_SELECTED:"CARD_SELECTED",OPPONENT_CARD_SELECTED:"OPPONENT_CARD_SELECTED",DISCARD_CARD:"DISCARD_CARD",CARD_DISCARDED:"CARD_DISCARDED",OPPONENT_CARD_DISCARDED:"OPPONENT_CARD_DISCARDED"},t.exports.cardWidth=55,t.exports.cardNames={al:"autumn",ar:"spring",bcg:"summer",blts:"winter",bsd:"winter",ca:"spring",fl:"spring",fls:"spring",fqx:"spring",sx:"spring",xf:"spring",xl:"summer",ywy:"summer",xy:"summer",yq:"summer",qy:"summer",hy:"autumn",yqs:"autumn",wry:"autumn",oysg:"autumn",qhzr:"autumn",xyz:"winter",sy:"winter",ly:"winter",hyue:"winter",qc:"spring",tyc:"summer",ws:"summer",pl:"summer",qyt:"autumn",zrl:"autumn",ys:"autumn",ths:"winter",yd:"winter",lyc:"winter",zm:"spring",lc:"spring",hllp:"summer",gjfj:"summer",gjhy:"summer",qysnp:"spring",jt:"summer",ttzq:"autumn",wmzj:"autumn",jql:"autumn",tzbz:"autumn",gjhg:"winter",wc:"winter",hykh:"winter",thg:"spring",jsh:"spring",snm:"winter"},cc._RF.pop()},{}],GameCanvas:[function(e,t,n){"use strict";cc._RF.push(t,"ca084i44hdKCoD8xoMth3MR","GameCanvas");var s=e("../Constants");cc.Class({extends:cc.Component,properties:{game:{default:null,type:cc.Node}},onLoad:function(){this.node.getChildByName("label").opacity=255},start:function(){var e=this;e.game.opacity=0,window.ws.send(JSON.stringify({type:s.events.PAIRING})),window.ws.onmessage=function(t){var n=JSON.parse(t.data);console.log("[".concat(new Date,"] WS data received"),n),n.type===s.events.START&&(e.node.getChildByName("label").opacity=0,e.game.opacity=255,e.game.getComponent("Game").init(n)),e.game.getComponent("Game").handleGameAction(n)}}}),cc._RF.pop()},{"../Constants":"Constants"}],Game:[function(e,t,n){"use strict";cc._RF.push(t,"a86aco55HxKDan9Hh+0ColS","Game");var s=e("../Constants");cc.Class({extends:cc.Component,properties:{cardsLeft:[],newCards:{default:null,type:cc.Node},myCards:{default:null,type:cc.Node},opponentCards:{default:null,type:cc.Node},selectedDeck:{default:null,type:cc.Node},opponentSelectedDeck:{default:null,type:cc.Node}},init:function(e){this.newCards.getComponent("newCards").initCards(e.deck),this.myCards.getComponent("MyCards").initCards(e.cards),this.opponentCards.getComponent("OpponentCards").initCards(),e.turn===window.playerId&&this.myCards.getComponent("MyCards").setAllCardsSelectable()},onSelectCard:function(e){var t=e.target.getComponent("card").cardName;this.myCards.children.forEach(function(t){t.getComponent("card").selected&&t._id!==e.target._id&&t.getComponent("card").unselectCard()}),this.newCards.getComponent("newCards").setMatchingCardsSelectable(t)},onUnSelectCard:function(){this.newCards.getComponent("newCards").setAllCardsUnselectable()},onCardSelected:function(){this.newCards.getComponent("newCards").moveSelectedCard(this.selectedDeck,null,!0),this.myCards.getComponent("MyCards").moveSelectedCard(this.selectedDeck)},showPair:function(e){if(e.newPairs.length){var t=0,n=this.node.getChildByName("pair");t++,this.scheduleOnce(function(){n.getComponent("Pair").show(e,0)},0),e.newPairs.length>1&&this.schedule(function(){n.getComponent("Pair").show(e,t),t++},2,e.newPairs.length-2,0)}},handleCardSelected:function(e){console.log("card selected"),this.newCards.getComponent("newCards").addCardToLast(e.deck[e.deck.length-1],e.deck.length-1),this.node.getChildByName("my score").getChildByName("points").getComponent(cc.Label).string=e.score,this.showPair(e)},discardCard:function(e){this.myCards.getComponent("MyCards").checkRequireDiscardCard(e)?(this.node.getChildByName("left panel label").opacity=255,window.discardingCard=!0):this.node.getChildByName("left panel label").opacity=0},handleOpponentCardSelected:function(e){console.log("opponent card selected"),this.newCards.children.forEach(function(t){t.getComponent("card").cardName===e.opponentSelectedDeckCard&&(window.selectedDeckCard=t)});var t=this;this.newCards.getComponent("newCards").moveSelectedCard(this.opponentSelectedDeck,function(){t.newCards.getComponent("newCards").addCardToLast(e.deck[e.deck.length-1],e.deck.length-1),t.myCards.getComponent("MyCards").setAllCardsSelectable()},!1),this.node.getChildByName("opponent score").getChildByName("points").getComponent(cc.Label).string=e.opponentScore,this.showPair(e),this.discardCard(e)},handleCardDiscarded:function(e){var t=e.cards.length-1;this.myCards.getComponent("MyCards").addCard(e.newCard,t),this.myCards.getComponent("MyCards").setAllCardsSelectable(),this.discardCard(e)},handleOpponentCardDiscarded:function(e){this.newCards.getComponent("newCards").addCardToLast(e.cardDiscarded,e.deck.length-1)},checkGameOver:function(e){!0===e.isGameOver&&(console.log("Game over!"),this.node.getChildByName("result").opacity=255,e.winner===window.playerId?this.node.getChildByName("result").getComponent(cc.Label).string="\u80dc\u5229":this.node.getChildByName("result").getComponent(cc.Label).string="\u5931\u8d25")},handleGameAction:function(e){e.type!==s.events.CARD_SELECTED&&e.type!==s.events.OPPONENT_CARD_SELECTED||this.checkGameOver(e),e.type===s.events.CARD_SELECTED&&this.handleCardSelected(e),e.type===s.events.OPPONENT_CARD_SELECTED&&this.handleOpponentCardSelected(e),e.type===s.events.CARD_DISCARDED&&this.handleCardDiscarded(e),e.type===s.events.OPPONENT_CARD_DISCARDED&&this.handleOpponentCardDiscarded(e)},onLoad:function(){this.node.on("select-card",this.onSelectCard,this),this.node.on("unselect-card",this.onUnSelectCard,this),this.node.on("card-selected",this.onCardSelected,this)},start:function(){},onDestroy:function(){this.node.off("select-card",this.onSelectCard,this),this.node.off("unselect-card",this.onUnSelectCard,this),this.node.off("card-selected",this.onCardSelected,this)}}),cc._RF.pop()},{"../Constants":"Constants"}],Gloabal:[function(e,t,n){"use strict";cc._RF.push(t,"38af3O0Z3dGsrgXO7NRo1Tz","Gloabal"),cc._RF.pop()},{}],Loading:[function(e,t,n){"use strict";cc._RF.push(t,"cb434NsCllB/73wMqnRr5sc","Loading");var s=e("../utils/websocket").initializeWs,c=e("../Constants");cc.Class({extends:cc.Component,properties:{nextScene:cc.SceneAsset},onLoad:function(){var e=this,t=s();window.ws=t,t.onopen=function(e){console.log("Send Text WS was opened.")},t.onmessage=function(t){console.log("response text msg: "+t.data);var n=JSON.parse(t.data);n.type===c.events.CREATE_PLAYER_ID&&(window.playerId=n.id,cc.director.loadScene(e.nextScene.name))}},start:function(){}}),cc._RF.pop()},{"../Constants":"Constants","../utils/websocket":"websocket"}],MyCards:[function(e,t,n){"use strict";cc._RF.push(t,"c12aad9vrxHS79lzqN8AKgd","MyCards");var s=e("../Constants");cc.Class({extends:cc.Component,properties:{cardPrefab:{default:null,type:cc.Prefab}},initCards:function(e){for(var t=0;t<e.length;t++){var n=cc.instantiate(this.cardPrefab);n.x=50*t-250,n.zIndex=100-t,n.getComponent("card").loadCard(e[t]),n.parent=this.node}},setAllCardsUnselectable:function(){this.node.children.forEach(function(e){e.getComponent("card").isSelectable=!1})},setAllCardsSelectable:function(){this.node.children.forEach(function(e){e.getComponent("card").isSelectable=!0})},moveCardsToLeft:function(e){for(var t=!1,n=this.node.children.length-1;n>=0;n--){var s=this.node.children[n];if(s._id!==e._id){if(t){var c=cc.moveBy(.2,-50,0);s.zIndex++,s.runAction(c)}}else t=!0}},moveSelectedCard:function(e){var t=cc.callFunc(function(t){window.selectedOwnCard.removeFromParent(),window.selectedOwnCard.x=0,window.selectedOwnCard.y=0,window.selectedOwnCard.zIndex=2*e.children.length,window.selectedOwnCard.parent=e},this),n=cc.sequence(cc.moveTo(.5,cc.v2(-400,0)),t);this.moveCardsToLeft(window.selectedOwnCard),window.selectedOwnCard.runAction(n)},checkRequireDiscardCard:function(e){var t=[];this.node.children.forEach(function(e){var n=s.cardNames[e.getComponent("card").cardName];-1===t.indexOf(n)&&t.push(n)});for(var n=0;n<e.deck.length;n++){var c=e.deck[n];if(t.indexOf(s.cardNames[c])>-1)return console.log("No need to discard"),!1}return console.log("Need to discard"),!0},addCard:function(e,t){var n=cc.instantiate(this.cardPrefab);n.x=50*t-250,n.zIndex=100-t,n.getComponent("card").loadCard(e),n.parent=this.node},onLoad:function(){},start:function(){},onDestroy:function(){}}),cc._RF.pop()},{"../Constants":"Constants"}],OpponentCards:[function(e,t,n){"use strict";cc._RF.push(t,"b49e6w3w49CqKAhxnpUfT16","OpponentCards"),cc.Class({extends:cc.Component,properties:{cardBackPrefab:{default:null,type:cc.Prefab}},initCards:function(e){for(var t=0;t<=8;t++){var n=cc.instantiate(this.cardBackPrefab);n.setPosition(50*t,0),n.parent=this.node}},start:function(){}}),cc._RF.pop()},{}],Pair:[function(e,t,n){"use strict";cc._RF.push(t,"4747cEkZjdIO6X5PZfNS0Cs","Pair"),cc.Class({extends:cc.Component,properties:{cardPrefab:{default:null,type:cc.Prefab}},loadPairImage:function(e,t){var n=cc.instantiate(this.cardPrefab);0===t?n.x=-100:1===t&&(n.x=100),n.scale=2,n.getComponent("card").loadCard(e),n.parent=this.node.getChildByName("cards")},loadPairText:function(e,t){this.node.getChildByName("label").getComponent(cc.Label).string="\u5b8c\u6210\u7ec4\u5bf9  ".concat(e," !   \u83b7\u5f97\u989d\u5916\u5206\u503c ").concat(t," \u5206\uff01")},show:function(e,t){var n=this,s=e.newPairs[t],c=this;this.node.opacity=255;var o=function(e){e.stopPropagation()};this.node.on(cc.Node.EventType.TOUCH_START,o),s.cards.forEach(function(e,t){n.node.getComponent("Pair").loadPairImage(e,t)}),this.node.getComponent("Pair").loadPairText(s.name,s.points),setTimeout(function(){c.node.opacity=0,c.node.getChildByName("cards").children.forEach(function(e){e.destroy(),c.node.off(cc.Node.EventType.TOUCH_START,o)})},1700)},onLoad:function(){this.node.on("card-selected",this.onCardSelected,this)},start:function(){}}),cc._RF.pop()},{}],SelectedDeck:[function(e,t,n){"use strict";cc._RF.push(t,"56f28fguktAnYtztu2MFkzN","SelectedDeck"),cc.Class({extends:cc.Component,properties:{cardPrefab:{default:null,type:cc.Prefab},cards:[]},start:function(){}}),cc._RF.pop()},{}],StartingPage:[function(e,t,n){"use strict";cc._RF.push(t,"1172cn3s3RBBodnV3tHyqIQ","StartingPage"),cc.Class({extends:cc.Component,properties:{nextScene:cc.SceneAsset},onClickButton:function(){cc.director.loadScene(this.nextScene.name)},onLoad:function(){},start:function(){}}),cc._RF.pop()},{}],card:[function(e,t,n){"use strict";cc._RF.push(t,"e5653Vfp9pESplcrIWxZwh2","card");var s=e("./utils/wsRequests"),c=e("./Constants");cc.Class({extends:cc.Component,properties:{selected:!1,isSelectable:!1,isOnHover:!1,cardName:""},loadCard:function(e){var t=this,n=this;cc.loader.load({url:"https://qian-qiu-xi.herokuapp.com/images/".concat(e,".jpg"),type:"jpeg"},function(s,c){if(s)cc.error(s);else{var o=new cc.SpriteFrame(c);n.getComponent(cc.Sprite).spriteFrame=o,t.cardName=e}})},handleCardSelected:function(){s.selectCardRequest(this.cardName,window.selectedOwnCard.getComponent("card").cardName),this.node.parent.parent.getChildByName("my cards").getComponent("MyCards").setAllCardsUnselectable(),this.node.parent.parent.getChildByName("new cards").getComponent("newCards").setAllCardsUnselectable(),this.node.dispatchEvent(new cc.Event.EventCustom("card-selected",!0))},discardCard:function(){var e=this.node.parent.getComponent("MyCards"),t=this.node.parent.parent.getChildByName("new cards");s.discardCardRequest(this.cardName);var n=this.node.parent.parent.getChildByName("new cards").children[0].getPosition().x+c.cardWidth,o=cc.callFunc(function(e){this.node.parent=t,this.node.y=0},this),a=cc.sequence(cc.moveTo(.5,cc.v2(n,210)),o);this.node.runAction(a),e.moveCardsToLeft(this.node),this.node.zIndex=100-t.children.length,this.isOnHover=!1,this.selected=!1,window.discardingCard=!1,e.setAllCardsUnselectable()},selectCard:function(){window.discardingCard&&"my cards"===this.node.parent.name?this.discardCard():this.isSelectable&&("new cards"===this.node.parent.name?(window.selectedDeckCard=this.node,this.handleCardSelected()):(this.node.y+=10,this.selected=!0,window.selectedOwnCard=this.node,this.node.dispatchEvent(new cc.Event.EventCustom("select-card",!0))))},unselectCard:function(){"my cards"===this.node.parent.name&&(this.node.y-=30,this.isOnHover=!1,this.selected=!1,this.node.dispatchEvent(new cc.Event.EventCustom("unselect-card",!0)))},onTouchStart:function(e){this.selected?this.unselectCard():this.selectCard(),e.stopPropagation()},onMouseEnter:function(){!this.isSelectable||this.selected||this.isOnHover||(this.node.y+=20,this.isOnHover=!0)},onMouseLeave:function(){this.isSelectable&&!this.selected&&this.isOnHover&&(this.node.y-=20,this.isOnHover=!1)},onLoad:function(){this.node.on(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.on(cc.Node.EventType.MOUSE_ENTER,this.onMouseEnter,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this.onMouseLeave,this)},start:function(){},onDestroy:function(){this.node.off(cc.Node.EventType.TOUCH_START,this.onTouchStart,this),this.node.off(cc.Node.EventType.MOUSE_ENTER,this.onMouseEnter,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this.onMouseLeave,this)}}),cc._RF.pop()},{"./Constants":"Constants","./utils/wsRequests":"wsRequests"}],newCards:[function(e,t,n){"use strict";cc._RF.push(t,"2b9ae0ykuVJmomTBPH6kcbh","newCards");var s=e("./Constants");cc.Class({extends:cc.Component,properties:{cardPrefab:{default:null,type:cc.Prefab}},moveSelectedCard:function(e,t,n){for(var c,o=cc.callFunc(function(n){window.selectedDeckCard.removeFromParent(),window.selectedDeckCard.x=0,window.selectedDeckCard.y=0,window.selectedDeckCard.zIndex=2*e.children.length+1,window.selectedDeckCard.parent=e,t&&t()},this),a=!1,r=this.node.children.length-1;r>=0;r--){var d=this.node.children[r];if(d._id!==window.selectedDeckCard._id){if(a){d.zIndex++;var i=cc.moveBy(.2,-s.cardWidth,0);d.runAction(i)}}else a=!0}c=n?cc.sequence(cc.moveTo(.5,cc.v2(-400,-210)),o):cc.sequence(cc.moveTo(.5,cc.v2(-400,210)),o),window.selectedDeckCard.runAction(c)},addCardToLast:function(e,t){var n=cc.instantiate(this.cardPrefab);n.x=s.cardWidth*t-300,n.zIndex=100-t,n.getComponent("card").loadCard(e),n.parent=this.node},setMatchingCardsSelectable:function(e){this.node.children.forEach(function(t){var n=t.getComponent("card").cardName;s.cardNames[n]===s.cardNames[e]?t.getComponent("card").isSelectable=!0:t.getComponent("card").isSelectable=!1})},setAllCardsUnselectable:function(){this.node.children.forEach(function(e){e.getComponent("card").isSelectable=!1})},initCards:function(e){for(var t=0;t<e.length;t++){var n=cc.instantiate(this.cardPrefab);n.x=s.cardWidth*t-300,n.zIndex=100-t,n.getComponent("card").loadCard(e[t]),n.parent=this.node}},start:function(){}}),cc._RF.pop()},{"./Constants":"Constants"}],websocket:[function(e,t,n){"use strict";cc._RF.push(t,"53449Ia0BJJFJMDU7TOYjtq","websocket");var s=e("../Constants").remoteUrl;t.exports.initializeWs=function(){console.log("WebSocket...",new Date);var e=new WebSocket("wss://".concat(s));return e.onerror=function(e){console.log("Send Text fired an error")},e.onclose=function(e){console.log("WebSocket instance closed.",new Date)},e},cc._RF.pop()},{"../Constants":"Constants"}],wsRequests:[function(e,t,n){"use strict";cc._RF.push(t,"07521YGti9LcJYbo6/kFCrs","wsRequests");e("./websocket");var s=e("../Constants");t.exports.discardCardRequest=function(e){window.ws.send(JSON.stringify({type:s.events.DISCARD_CARD,playerId:window.playerId,cardToDiscard:e}))},t.exports.selectCardRequest=function(e,t){window.ws.send(JSON.stringify({type:s.events.SELECT_CARD,playerId:window.playerId,selectedCardFromDeck:e,selectedOwnCard:t}))},t.exports.pairingRequest=function(){window.ws.send(JSON.stringify({type:s.events.PAIRING}))},cc._RF.pop()},{"../Constants":"Constants","./websocket":"websocket"}]},{},["Constants","Gloabal","StartingPage","card","CardModel","newCards","Game","GameCanvas","Loading","MyCards","OpponentCards","Pair","SelectedDeck","websocket","wsRequests"]);